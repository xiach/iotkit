webpackJsonp([19],{Csrp:function(t,e,i){e=t.exports=i("FZ+f")(!1),e.push([t.i,"\n.tip1[data-v-a24f381a] {\r\n    color: #314558;\n}\n.tip2[data-v-a24f381a] {\r\n    color: #314558;\n}\n.notice[data-v-a24f381a] {\r\n    color: #FF0000;\n}\n.tip-binding[data-v-a24f381a] {\r\n    margin-top: 20px;\r\n    color: #c0c4cc;\n}\n.handle-select-product[data-v-a24f381a]{\r\n    width: 30%;\r\n    margin-top: 20px;\r\n    margin-bottom: 20px;\n}\n.addparam[data-v-a24f381a] {\r\n    margin-bottom: 1rem;\n}\r\n",""])},OrQI:function(t,e,i){var a=i("Csrp");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i("rjj0")("48bdd1fd",a,!0,{})},fh8v:function(t,e,i){"use strict";function a(t){i("OrQI")}Object.defineProperty(e,"__esModule",{value:!0});var o=i("UgCr"),r=(i("xV2B"),{data:function(){return{listLoading:!1,productId:"",products:[],activeName:"binding",bindingMode:"sharing",isChange:!1,attrId:"",scenes:[],capabilities:[],editFormVisible:!1,editLoading:!1,editFormRules:{name:[{required:!0,message:this.$t("common.holderInput"),trigger:"blur"}],key:[{required:!0,message:this.$t("common.holderInput"),trigger:"blur"}],value:[{required:!0,message:this.$t("common.holderInput"),trigger:"blur"}],direction:[{required:!0,message:this.$t("common.holderSelect"),trigger:"change"}],type:[{required:!0,message:this.$t("common.holderSelect"),trigger:"change"}]},editForm:{name:"",key:"",direction:"",type:"",value:""}}},computed:{title:function(){return this.isChange?this.$t("product.modifyParam"):this.$t("product.addPriParam")},directions:function(){return[{key:"upstream",label:this.$t("product.paramUp")},{key:"downstream",label:this.$t("product.paramDown")},{key:"bidirectional",label:this.$t("product.paramBidir")}]},types:function(){return[{key:"switch",label:this.$t("product.paramswitch")},{key:"enum",label:this.$t("product.paramenum")},{key:"range",label:this.$t("product.paramrange")},{key:"string",label:this.$t("product.paramstring")},{key:"time",label:this.$t("product.paramtime")},{key:"fault",label:this.$t("product.paramfault")}]}},mounted:function(){var t=this;this.products=[],o.a.getAllProducts().then(function(e){t.products=e.data.result}).catch(function(t){})},methods:{checkProductProtocol:function(){var t=this,e=!1;return this.products.forEach(function(i){i.id==t.productId&&"default"==i.protocol&&(e=!0)}),e},capFormatter:function(t,e){return t.name+"("+t.key+")"},dirFormatter:function(t,e){return"upstream"==t.direction?this.$t("product.paramUp"):"downstream"==t.direction?this.$t("product.paramDown"):"bidirectional"==t.direction?this.$t("product.paramBidir"):void 0},typeFormatter:function(t,e){return"standard"==t.kind?this.$t("product.paramStand"):"private"==t.kind?this.$t("product.paramPrivate"):void 0},valFormatter:function(t,e){return"switch"==t.type?this.$t("product.paramswitch"):"enum"==t.type?this.$t("product.paramenum"):"range"==t.type?this.$t("product.paramrange"):"string"==t.type?this.$t("product.paramstring"):"time"==t.type?this.$t("product.paramtime"):"fault"==t.type?this.$t("product.paramfault"):void 0},updateCapability:function(){var t=this,e=this;this.listLoading=!0,o.a.getProduct(this.productId).then(function(i){t.listLoading=!1,e.capabilities=i.data.capability,e.capabilities.sort(function(t,e){return t.type[0]-e.type[0]})}).catch(function(e){t.listLoading=!1})},updateSceneCfg:function(){var t=this,e=this;this.listLoading=!0,this.scenes=[],this.capabilities=[],o.a.getAllSceneCfg(this.productId).then(function(i){t.listLoading=!1,t.scenes=i.data.result,o.a.getProduct(t.productId).then(function(t){t.data.capability.forEach(function(t){var i=!1;e.scenes.forEach(function(e){t.key==e.key&&(i=!0)}),i||"upstream"==t.direction||e.capabilities.push(t)})}).catch(function(t){})}).catch(function(e){t.listLoading=!1})},handleClick:function(t,e){this.productId=""},getProductLabel:function(t){return t.model+"("+t.species+")"},handleAddCap:function(){if(!this.checkProductProtocol())return void this.$message.error(this.$t("product.tipNotSupportProtocol"));this.editFormVisible=!0,this.isChange=!1,this.editForm.name="",this.editForm.key="",this.editForm.direction="",this.editForm.type="",this.editForm.value=""},handleEditCap:function(t,e){var i=this.capabilities[t];this.isChange=!0,this.editFormVisible=!0,this.attrId=i.id,this.editForm.name=i.name,this.editForm.key=i.key,this.editForm.direction=i.direction,this.editForm.type=i.type,this.editForm.value=i.value},handleDeleteCap:function(t,e){var i=this;this.$confirm(this.$t("common.toDelete"),this.$t("common.tip"),{type:"warning"}).then(function(){i.onDeleteCap(t,e)}).catch(function(){})},onDeleteCap:function(t,e){var i=this;this.listLoading=!0,o.a.deleteCapability(this.capabilities[t].id).then(function(t){i.$message.success(i.$t("common.tipSuccess")),i.updateCapability()}).catch(function(t){i.listLoading=!1})},handleAddScene:function(){if(!this.checkProductProtocol())return void this.$message.error(this.$t("product.tipNotSupportProtocol"));this.editFormVisible=!0,this.editForm.key=""},handleDeleteScene:function(t,e){var i=this;this.$confirm(this.$t("common.toDelete"),this.$t("common.tip"),{type:"warning"}).then(function(){i.onDeleteScene(t,e)}).catch(function(){})},onDeleteScene:function(t,e){var i=this,a=this;this.listLoading=!0,this.scenes.splice(t,1);var r=[];this.scenes.forEach(function(t){r.push(t.key)}),o.a.setAllSceneCfg(this.productId,r.join(",")).then(function(t){i.updateSceneCfg(),a.$message.success(a.$t("common.tipSuccess"))}).catch(function(t){a.listLoading=!1,a.$message.success(a.$t("common.tipFailed"))})},editSubmit:function(t){var e=this,i=this,a=null,r=this.editForm;i.$refs[t].validate(function(n){if(n)if("editFormScene"==t){i.editLoading=!0;var s=[e.editForm.key];e.scenes.forEach(function(t){s.push(t.key)}),o.a.setAllSceneCfg(e.productId,s.join(",")).then(function(t){i.editLoading=!1,i.editFormVisible=!1,e.updateSceneCfg(),i.$message.success(i.$t("common.tipSuccess"))}).catch(function(t){i.editLoading=!1,i.editFormVisible=!1,i.$message.success(i.$t("common.tipFailed"))})}else"editFormCap"==t&&(a=i.isChange?o.a.changeCapability(i.attrId,r.key,r.name,r.type,r.direction,r.value):o.a.addCapability(e.productId,r.key,r.name,r.type,r.direction,r.value),i.editLoading=!0,a.then(function(t){i.editLoading=!1,i.editFormVisible=!1,i.updateCapability(),e.$message.success(e.$t("common.tipSuccess"))}).catch(function(t){i.editLoading=!1,i.editFormVisible=!1}))})},closeDlgScene:function(){this.editFormVisible=!1,this.editForm.key=""},closeDlgCap:function(){this.editFormVisible=!1,this.editForm.name="",this.editForm.key="",this.editForm.direction="",this.editForm.type="",this.editForm.value=""},getProductBinding:function(){var t=this,e="";return this.products.forEach(function(i){i.id==t.productId&&(e=i.binding)}),e}},watch:{productId:function(t,e){this.productId&&("scene"==this.activeName?(this.editFormRules.key[0].trigger="change",this.editFormRules.key[0].message=this.$t("common.holderSelect"),this.updateSceneCfg()):"func"==this.activeName?(this.editFormRules.key[0].trigger="blur",this.editFormRules.key[0].message=this.$t("common.holderInput"),this.updateCapability()):"binding"==this.activeName&&(this.bindingMode=this.getProductBinding()))}}}),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:t.$t("product.binding"),name:"binding"}},[i("div",{staticClass:"tip1"},[t._v(t._s(t.$t("product.tipBinding")))])]),t._v(" "),i("el-tab-pane",{attrs:{label:t.$t("product.func"),name:"func"}},[i("div",{staticClass:"tip1"},[t._v(t._s(t.$t("product.tipFunc")))])]),t._v(" "),i("el-tab-pane",{attrs:{label:t.$t("route.tenantScenecfg"),name:"scene"}},[i("div",{staticClass:"tip1"},[t._v(t._s(t.$t("product.tipScene")))])])],1),t._v(" "),i("el-select",{staticClass:"handle-select-product",attrs:{placeholder:t.$t("message.productHolder")},model:{value:t.productId,callback:function(e){t.productId=e},expression:"productId"}},[t._l(t.products,function(e){return[i("el-option",{key:e.id,attrs:{label:t.getProductLabel(e),value:e.id}})]})],2),t._v(" "),"binding"==t.activeName?i("div",[t.productId?i("el-radio-group",{attrs:{disabled:""},model:{value:t.bindingMode,callback:function(e){t.bindingMode=e},expression:"bindingMode"}},[i("el-radio",{attrs:{label:"sharing"}},[t._v(t._s(t.$t("product.sharing")))]),t._v(" "),i("el-radio",{attrs:{label:"exclusive"}},[t._v(t._s(t.$t("product.exclusive")))])],1):t._e(),t._v(" "),t.productId?i("div",{staticClass:"tip-binding"},[i("div",[t._v(t._s(t.$t("product.tipSharing")))]),t._v(" "),i("div",[t._v(t._s(t.$t("product.tipExclusive")))])]):t._e()],1):t._e(),t._v(" "),"func"==t.activeName?i("div",[t.productId?i("el-button",{staticClass:"addparam",attrs:{type:"success"},on:{click:t.handleAddCap}},[t._v(t._s(t.$t("product.addPriParam")))]):t._e(),t._v(" "),t.productId?i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.capabilities,border:"",strip:"",size:"mini"}},[i("el-table-column",{attrs:{type:"index",width:"40"}}),t._v(" "),i("el-table-column",{attrs:{prop:"kind",label:t.$t("product.paramType"),width:"100",formatter:t.typeFormatter}}),t._v(" "),i("el-table-column",{attrs:{prop:"name",label:t.$t("product.paramName"),width:"100"}}),t._v(" "),i("el-table-column",{attrs:{prop:"key",label:t.$t("product.paramID"),width:"200"}}),t._v(" "),i("el-table-column",{attrs:{prop:"direction",label:t.$t("product.paramDir"),width:"80",formatter:t.dirFormatter}}),t._v(" "),i("el-table-column",{attrs:{prop:"type",label:t.$t("product.paramVal"),width:"80",formatter:t.valFormatter}}),t._v(" "),i("el-table-column",{attrs:{prop:"value",label:t.$t("product.paramDesc")}}),t._v(" "),i("el-table-column",{attrs:{label:t.$t("common.operation"),width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button-group",[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(i){t.handleEditCap(e.$index,e.row)}}},[t._v(t._s(t.$t("common.edit")))]),t._v(" "),i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(i){t.handleDeleteCap(e.$index,e.row)}}},[t._v(t._s(t.$t("common.delete")))])],1)]}}])})],1):t._e(),t._v(" "),t.editFormVisible?i("el-dialog",{attrs:{title:t.title,visible:t.editFormVisible,"close-on-click-modal":!1,"before-close":t.closeDlgCap}},[i("el-form",{ref:"editFormCap",attrs:{model:t.editForm,"label-width":"80px",rules:t.editFormRules}},[i("el-form-item",{attrs:{label:t.$t("product.paramName"),prop:"name"}},[i("el-input",{attrs:{readonly:t.isChange},model:{value:t.editForm.name,callback:function(e){t.$set(t.editForm,"name",e)},expression:"editForm.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:t.$t("product.paramID"),prop:"key"}},[i("el-input",{attrs:{readonly:t.isChange},model:{value:t.editForm.key,callback:function(e){t.$set(t.editForm,"key",e)},expression:"editForm.key"}})],1),t._v(" "),i("el-form-item",{attrs:{label:t.$t("product.paramDir"),prop:"direction"}},[i("el-select",{staticClass:"handle-select",attrs:{placeholder:t.$t("common.holderSelect")},model:{value:t.editForm.direction,callback:function(e){t.$set(t.editForm,"direction",e)},expression:"editForm.direction"}},[t._l(t.directions,function(t){return[i("el-option",{key:t.key,attrs:{label:t.label,value:t.key}})]})],2)],1),t._v(" "),i("el-form-item",{attrs:{label:t.$t("product.paramVal"),prop:"type"}},[i("el-select",{staticClass:"handle-select",attrs:{placeholder:t.$t("common.holderSelect")},model:{value:t.editForm.type,callback:function(e){t.$set(t.editForm,"type",e)},expression:"editForm.type"}},[t._l(t.types,function(t){return[i("el-option",{key:t.key,attrs:{label:t.label,value:t.key}})]})],2)],1),t._v(" "),"string"!=t.editForm.type&&"time"!=t.editForm.type?i("el-form-item",{attrs:{label:t.$t("product.paramDesc"),prop:"value"}},[i("el-input",{attrs:{readonly:"switch"==t.editForm.type},model:{value:t.editForm.value,callback:function(e){t.$set(t.editForm,"value",e)},expression:"editForm.value"}}),t._v(" "),i("span",{staticClass:"notes"},[t._v(t._s(t.$t("product.noteVal")))])],1):t._e()],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:t.closeDlgCap}},[t._v(t._s(t.$t("common.cancel")))]),t._v(" "),i("el-button",{attrs:{type:"danger",loading:t.editLoading},on:{click:function(e){t.editSubmit("editFormCap")}}},[t._v(t._s(t.$t("common.commit")))])],1)],1):t._e()],1):t._e(),t._v(" "),"scene"==t.activeName?i("div",[t.productId?i("el-button",{staticClass:"addparam",attrs:{type:"success"},on:{click:t.handleAddScene}},[t._v(t._s(t.$t("product.btnAddNewScene")))]):t._e(),t._v(" "),t.productId?i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"sceneTable",staticStyle:{width:"100%"},attrs:{data:t.scenes,border:"",strip:"",size:"mini"}},[i("el-table-column",{attrs:{type:"index",width:"40"}}),t._v(" "),i("el-table-column",{attrs:{prop:"key",label:t.$t("message.param"),width:"200",formatter:t.capFormatter}}),t._v(" "),i("el-table-column",{attrs:{prop:"type",label:t.$t("product.paramVal"),formatter:t.valFormatter}}),t._v(" "),i("el-table-column",{attrs:{prop:"value",label:t.$t("product.paramDesc")}}),t._v(" "),i("el-table-column",{attrs:{prop:"direction",label:t.$t("product.paramDir"),formatter:t.dirFormatter}}),t._v(" "),i("el-table-column",{attrs:{label:t.$t("common.operation"),width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button-group",[i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(i){t.handleDeleteScene(e.$index,e.row)}}},[t._v(t._s(t.$t("common.delete")))])],1)]}}])})],1):t._e(),t._v(" "),t.editFormVisible?i("el-dialog",{attrs:{title:t.$t("product.btnAddNewScene"),visible:t.editFormVisible,"close-on-click-modal":!1,"before-close":t.closeDlgScene}},[i("el-form",{ref:"editFormScene",attrs:{model:t.editForm,"label-width":"80px",rules:t.editFormRules}},[i("el-form-item",{attrs:{label:t.$t("message.param"),prop:"key"}},[i("el-select",{attrs:{placeholder:t.$t("common.holderSelect")},model:{value:t.editForm.key,callback:function(e){t.$set(t.editForm,"key",e)},expression:"editForm.key"}},[t._l(t.capabilities,function(t){return[i("el-option",{key:t.key,attrs:{label:t.name+"("+t.key+")",value:t.key}})]})],2)],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:t.closeDlgScene}},[t._v(t._s(t.$t("common.cancel")))]),t._v(" "),i("el-button",{attrs:{type:"danger",loading:t.editLoading},on:{click:function(e){t.editSubmit("editFormScene")}}},[t._v(t._s(t.$t("common.commit")))])],1)],1):t._e()],1):t._e()],1)},s=[],c={render:n,staticRenderFns:s},l=c,d=i("VU/8"),u=a,p=d(r,l,!1,u,"data-v-a24f381a",null);e.default=p.exports}});